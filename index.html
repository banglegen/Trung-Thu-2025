<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trung Thu 3D</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Brush+Script+MT&display=swap');

    :root{
      --bg:#0b1020;
      --moon:#fffae1;
      --lantern-main:#ff0000;
      --lantern-accent:#ffd88a;
      --glow:0 0 30px rgba(255,170,120,0.12),0 6px 40px rgba(0,0,0,0.6);
      --font:'Inter',system-ui;
    }
    html,body{height:100%;margin:0;font-family:var(--font);background:linear-gradient(180deg,var(--bg) 0%,#071025 70%);overflow:hidden;color:#fff}
    .scene{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;perspective:1200px;position:relative;user-select:none}
    canvas#stars{position:absolute;inset:0;z-index:0}
    .moon-wrap{position:absolute;top:8vh;right:8vw;transform-style:preserve-3d;z-index:2}
    .moon{width:170px;height:170px;border-radius:50%;background:radial-gradient(circle at 30% 25%,#fff 0%,var(--moon) 30%,#ffd 55%,#f1e6cf 70%,rgba(241,230,207,0.6));box-shadow:0 0 60px rgba(255,250,205,0.14),inset -14px -8px 30px rgba(0,0,0,0.08);transform:translateZ(200px) rotateX(10deg)}
    .horizon{position:absolute;bottom:0;left:0;right:0;height:28vh;background:linear-gradient(180deg,transparent,#021017 60%,#02060b 100%);z-index:2}
    .trees{position:absolute;left:6vw;bottom:2vh;display:flex;gap:10px;transform:translateZ(80px)}
    .tree{width:60px;height:120px;background:linear-gradient(180deg,#052218,#02160f);clip-path:polygon(50% 0,70% 30%,58% 30%,80% 55%,60% 55%,78% 100%,50% 75%,22% 100%,40% 55%,20% 55%,42% 30%,30% 30%);opacity:.9}
    .lanterns{position:relative;z-index:3;transform-style:preserve-3d}
    .lantern{width:140px;height:220px;position:absolute;left:50%;top:50%;transform-style:preserve-3d;transform:translate3d(-50%,-50%,0) rotateX(12deg);animation:float 8s ease-in-out infinite;will-change:transform}
    .lantern:hover{transform:translate3d(-50%,-50%,60px) rotateX(12deg) scale(1.06)}
    @keyframes float{0%{transform:translate3d(-50%,-50%,0) rotateX(12deg) translateY(-4px)}50%{transform:translate3d(-50%,-50%,8px) rotateX(10deg) translateY(6px)}100%{transform:translate3d(-50%,-50%,0) rotateX(12deg) translateY(-4px)}}
    .band{position:absolute;left:50%;width:120px;height:18px;background:linear-gradient(90deg,var(--lantern-accent),#ffd);transform:translateX(-50%);top:26%;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.35)}
    .band.bottom{top:62%}
    .tassel{position:absolute;left:50%;bottom:-36px;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:6px}
    .tassel .stick{width:6px;height:38px;background:linear-gradient(180deg,#2b100d,#6b250f);border-radius:3px}
    .tassel .strings{display:flex;gap:8px}
    .tassel .strings span{width:6px;height:34px;border-radius:4px;background:linear-gradient(180deg,#ff9d9d,#ff5b5b);transform-origin:top;animation:wag 3s ease-in-out infinite}
    .tassel .strings span:nth-child(2){animation-delay:.12s}
    .tassel .strings span:nth-child(3){animation-delay:.24s}
    @keyframes wag{0%{transform:rotate(0)}50%{transform:rotate(6deg)}100%{transform:rotate(0)}}
    .hud{position:absolute;left:18px;top:18px;z-index:6;background:rgba(0,0,0,0.25);backdrop-filter:blur(6px);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);color:#fff}
    .hud label{font-size:13px;opacity:.95}
    .hud input[type=color]{width:44px;height:36px;border:0;background:none;padding:0;margin-left:8px}
    .hud .range{width:140px}
    .credit{position:absolute;right:12px;bottom:12px;color:rgba(255,255,255,0.55);font-size:13px;z-index:6}
    .title{position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);font-family:'Brush Script MT',cursive;font-size:70px;color:#ffe8b3;text-shadow:0 0 20px rgba(255,255,200,0.4),0 0 40px rgba(255,240,200,0.2);z-index:5;white-space:nowrap}
    .moon-small{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,#f9e58a 60%,#e6b84c 100%);box-shadow:0 0 25px #ffd700,0 0 50px #ffb300;animation:spin 6s linear infinite;z-index:1000;}
    @keyframes spin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
    #playBtn{position:fixed;top:20px;left:20px;z-index:1000;padding:8px 14px;background:#ffcc66;border:none;border-radius:6px;color:#000;font-weight:bold;cursor:pointer;}
  </style>
</head>
<body>
  <div class="scene" id="scene">
    <canvas id="stars"></canvas>
    <div class="moon-wrap"><div class="moon"></div></div>
    <div class="lanterns" id="lanterns"></div>
    <div class="title">Chúc Mừng Trung Thu</div>
    <div class="horizon"><div class="trees"><div class="tree"></div><div class="tree" style="transform:scale(.9)"></div><div class="tree" style="transform:scale(.8)"></div></div></div>
    <div class="hud">
      <div style="display:flex;gap:8px;align-items:center"><label for="color">Màu đèn</label><input id="color" type="color" value="#ff6b6b"></div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center"><label for="size">Vòng ngoài</label><input id="size" class="range" type="range" min="60" max="160" value="90"></div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center"><button id="addLantern">Thêm đèn</button><button id="clearLanterns">Xóa</button></div>
    </div>
    <div class="credit">Được làm bởi banglegen</div>
  </div>

  <!-- Trăng nhỏ -->
  <div class="moon-small"></div>

  <!-- Nút bật nhạc -->
  <button id="playBtn">▶ Bật nhạc</button>

  <!-- Audio -->
  <audio id="bgm" src="https://raw.githubusercontent.com/banglegen/Trung-Thu-2025/main/Tr%C3%B2%20Chơi%20Tháp%20Rơi%20T%E1%BB%B1%20Do.mp3" loop></audio>

  <script>
    const audio = document.getElementById('bgm');
    const playBtn = document.getElementBy
